Here you go â€” full file with **Aave = TVL + Borrowed âˆ’ \$2B** baked in and reflected in the tooltip and footer line.

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Aave vs Banks</title>
  <style>
    :root{
      --bg:#9C8CF4; --card:rgba(255,255,255,.06); --card-2:rgba(255,255,255,.08);
      --highlight:rgba(255,255,255,.22); --text:#ffffff; --up:#31d158; --down:#ff6b6b;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family: Arial, sans-serif;background: var(--bg);color: var(--text);} 
    .container{max-width:1000px;margin:0 auto;padding:48px 20px 24px;}
    header h1{font-size: clamp(32px, 5vw, 64px);margin:0 0 10px;}
    header p{margin:0 0 12px;opacity:.95;font-size: clamp(14px, 1.6vw, 18px);} 
    .controls{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin: 16px 0 28px;}
    .btn{appearance:none;border:none;cursor:pointer;padding:10px 16px;border-radius:999px;background: rgba(255,255,255,.16);border:1px solid rgba(255,255,255,.32);color:var(--text);font-weight:700;letter-spacing:.02em;transition: transform .06s ease, opacity .2s ease;}
    .btn:hover{ transform: translateY(-1px);} .btn:active{ transform: translateY(0);} .btn[disabled]{opacity:.6;cursor:not-allowed;}

    table{width:100%;border-collapse:separate;border-spacing:0;background: var(--card);border-radius:18px;overflow:hidden;}
    th, td{padding:18px 20px;text-align:left;vertical-align:middle;}
    th{font-size:14px;letter-spacing:.06em;text-transform:uppercase;opacity:.85;border-bottom:1px solid rgba(255,255,255,.16);} 
    tr:nth-child(even){background: var(--card-2);} 
    .highlight{position:relative;background: var(--highlight) !important;font-weight:700;}
    .highlight::before{content:"";position:absolute;inset:0 auto 0 0;width:6px;background: linear-gradient(180deg, #fff, rgba(255,255,255,.5));}
    .aave-row.highlight::before{display:none;}

    /* Special Aave treatment */
    .aave-row{position:relative;background: linear-gradient(90deg, rgba(255,255,255,.10), rgba(255,255,255,.06)) !important;}
    .aave-badge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:999px;background: rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.28);backdrop-filter: blur(2px);font-weight:700;}
    .aave-badge a{color:inherit;text-decoration:none;}
    .aave-arrow{display:inline-block;font-size:18px;line-height:1;padding:2px 8px;border-radius:999px;background: rgba(0,0,0,.18);border:1px solid rgba(255,255,255,.28);box-shadow: inset 0 0 10px rgba(255,255,255,.12);} 
    @keyframes aaveSlide { 0% { transform: translateX(0); } 50% { transform: translateX(4px); } 100% { transform: translateX(0); } }
    .aave-arrow{animation: aaveSlide 1.6s ease-in-out infinite;}

    .rank-change{display:none}
    .info{text-align:center;padding:14px 10px;font-size:14px;opacity:.85;}
    .loading{text-align:center;padding:40px;opacity:0.7;} 
    .error{color:#ffedee;text-align:center;padding:20px;font-size:14px;} 
    .last-updated{text-align:center;margin-top:12px;font-size:12px;opacity:0.7;} 
    .tagline{margin-top:20px;font-weight:700;letter-spacing:.02em;text-align:center;} 

    .ellipsis-row td{ text-align:center; font-weight:800; letter-spacing:.2em; opacity:.9; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Aave vs Banks</h1>
      <p>Built in a rush with love by Hoobi</p>
      <div class="controls">
        <button id="refreshBtn" class="btn">ðŸ”„ Refresh website</button>
        <span id="dataState" class="info" role="status"></span>
      </div>
    </header>

    <div class="table-container">
      <div id="loading" class="loading" role="status" aria-live="polite">Loading data...</div>
      <table id="dataTable" style="display:none;" aria-label="Aave vs Banks ranking">
        <thead>
          <tr>
            <th scope="col">Rank</th>
            <th scope="col">Name</th>
            <th scope="col">Assets</th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
      <div id="error" class="error" style="display:none;"></div>
    </div>

    <div id="lastUpdated" class="last-updated" aria-live="polite"></div>
    <p class="tagline">DeFi will win, Ethereum will win!</p>
  </div>

  <script>
    const CACHE_KEYS = { banks: 'avb:banks', aave: 'avb:aave', ts: 'avb:lastUpdatedISO', aaveMeta: 'avb:aaveMeta', morpho:'avb:morpho', spark:'avb:spark' };

    // ---- Fallback dataset (trimmed Federal Reserve snapshot from earlier) ----
    const bankData = [
      { name: "JPMORGAN CHASE BK NA", assets: 3643.099 },
      { name: "BANK OF AMER NA", assets: 2615.296 },
      { name: "CITIBANK NA", assets: 1760.921 },
      { name: "WELLS FARGO BK NA", assets: 1711.028 },
      { name: "U S BK NA", assets: 659.191 },
      { name: "GOLDMAN SACHS BK USA", assets: 598.460 },
      { name: "PNC BK NA", assets: 549.324 },
      { name: "TRUIST BK", assets: 527.488 },
      { name: "CAPITAL ONE NA", assets: 490.573 },
      { name: "STATE STREET B&TC", assets: 368.219 },
      { name: "TD BK NA", assets: 366.507 },
      { name: "BANK OF NY MELLON", assets: 356.262 },
      { name: "BMO BK NA", assets: 257.049 },
      { name: "MORGAN STANLEY BK NA", assets: 234.481 },
      { name: "FIRST-CITIZENS B&TC", assets: 228.632 },
      { name: "CITIZENS BK NA", assets: 220.014 },
      { name: "FIFTH THIRD BK NA", assets: 211.921 },
      { name: "MANUFACTURERS & TRADERS TC", assets: 209.801 },
      { name: "HUNTINGTON NB", assets: 208.159 },
      { name: "AMERICAN EXPRESS NB", assets: 203.448 },
      { name: "KEYBANK NA", assets: 185.776 },
      { name: "ALLY BK", assets: 182.323 },
      { name: "HSBC BK USA NA", assets: 166.237 },
      { name: "NORTHERN TC", assets: 164.498 },
      { name: "REGIONS BK", assets: 158.421 },
      { name: "DISCOVER BK", assets: 145.413 },
      { name: "SANTANDER BK NA", assets: 104.559 },
      { name: "FLAGSTAR BK NA", assets: 97.568 },
      { name: "CITY NB", assets: 93.149 },
      { name: "ZIONS BC NA", assets: 87.992 },
      { name: "WESTERN ALLI BK", assets: 82.944 },
      { name: "FIRST HORIZON BK", assets: 81.202 },
      { name: "WEBSTER BK NA", assets: 80.212 },
      { name: "COMERICA BK", assets: 77.698 },
      { name: "EAST WEST BK", assets: 75.712 },
      { name: "UMB BK NA", assets: 69.014 },
      { name: "SOUTHSTATE BK NA", assets: 65.109 },
      { name: "VALLEY NB", assets: 61.818 },
      { name: "CIBC BK USA", assets: 61.303 },
      { name: "SYNOVUS BK", assets: 60.208 },
      { name: "PINNACLE BK", assets: 54.173 },
      { name: "OLD NB", assets: 53.574 },
      { name: "FROST BK", assets: 52.059 },
      { name: "UMPQUA BK", assets: 51.509 },
      { name: "BOKF NA", assets: 50.345 },
      { name: "FIRST NB OF PA", assets: 48.800 },
      { name: "CADENCE BK", assets: 47.743 },
      { name: "BARCLAYS BK DE", assets: 45.277 },
      { name: "ASSOCIATED BK NA", assets: 43.249 },
      { name: "RAYMOND JAMES BK", assets: 41.907 },
      { name: "EVERBANK NA", assets: 41.858 },
      { name: "DEUTSCHE BK TC AMERICAS", assets: 39.663 },
      { name: "BANK OZK", assets: 39.165 },
      { name: "PROSPERITY BK", assets: 38.764 },
      { name: "BANKUNITED NA", assets: 34.811 },
      { name: "HANCOCK WHITNEY BK", assets: 34.732 },
      { name: "BANC OF CA", assets: 33.692 },
      { name: "SOFI BK NA", assets: 32.857 },
      { name: "UNITED BK", assets: 32.691 },
      { name: "COMMERCE BK", assets: 32.239 },
      { name: "FULTON BK NA", assets: 31.989 },
      { name: "FIRST NB OF OMAHA", assets: 31.792 },
      { name: "TEXAS CAP BK", assets: 31.103 },
      { name: "BNY MELLON NA", assets: 30.061 },
      { name: "FIRST INTRST BK", assets: 28.204 },
      { name: "GLACIER BK", assets: 27.842 },
      { name: "UNITED CMNTY BK", assets: 27.827 },
      { name: "WASHINGTON FED BK", assets: 27.629 },
      { name: "WESBANCO BK", assets: 27.321 },
      { name: "CITY NB OF FL", assets: 27.175 },
      { name: "ARVEST BK", assets: 27.136 },
      { name: "FIRSTBANK", assets: 27.110 },
      { name: "SIMMONS BK", assets: 26.749 },
      { name: "AMERIS BK", assets: 26.428 }
    ];

    function formatAssets(amount) { return `$${amount.toFixed(1)} B`; }

    function latestNumberFrom(arr, preferKeys = []){
      if (!arr || !Array.isArray(arr) || arr.length === 0) return null;
      const latest = arr[arr.length - 1];
      if (typeof latest === 'number') return latest;
      if (latest && typeof latest === 'object'){
        for (const k of preferKeys){ if (typeof latest[k] === 'number') return latest[k]; }
        for (const [,v] of Object.entries(latest)){
          if (typeof v === 'number') return v;
        }
      }
      return null;
    }

    async function fetchJSON(url){ const r = await fetch(url, { cache:'no-store' }); if(!r.ok) throw new Error('bad '+url); return r.json(); }

    // -------- Aave Full Value (Adjusted): TVL + Borrowed âˆ’ $2B --------
    async function fetchAaveFullValue(){
      try{
        const d = await fetchJSON('https://api.llama.fi/protocol/aave');
        let tvlUsd = Array.isArray(d.tvl) ? latestNumberFrom(d.tvl, ['totalLiquidityUSD','totalLiquidityUsd','tvl']) : null;
        let borrowedUsd = Array.isArray(d.borrowed) ? latestNumberFrom(d.borrowed, ['borrowed','totalBorrowedUSD','totalBorrowedUsd','totalBorrows']) : null;

        if ((tvlUsd==null || borrowedUsd==null) && d.chainTvls){
          let tvlSum=0, tF=false, borSum=0, bF=false;
          for(const chain of Object.values(d.chainTvls)){
            const cTVL = latestNumberFrom(chain.tvl, ['tvl','totalLiquidityUSD','totalLiquidityUsd']); if (typeof cTVL==='number'){ tvlSum+=cTVL; tF=true; }
            const cBor = latestNumberFrom(chain.borrowed || chain.borrows, ['borrowed','totalBorrowedUSD','totalBorrowedUsd','totalBorrows']); if (typeof cBor==='number'){ borSum+=cBor; bF=true; }
          }
          if(tvlUsd==null && tF) tvlUsd = tvlSum;
          if(borrowedUsd==null && bF) borrowedUsd = borSum;
        }

        // Apply custom formula: TVL + Borrowed âˆ’ $2B
        const adjustedUsd = (tvlUsd||0) + (borrowedUsd||0) - 2e9;
        const fullValueB = Math.max(0, adjustedUsd) / 1e9;

        return { valueB: fullValueB, meta:{ tvlUsd, borrowedUsd, adjustmentUsd: -2e9 } };
      }catch(e){
        console.error('Aave fetch failed', e);
        return { valueB: null, meta:{ tvlUsd:null, borrowedUsd:null, adjustmentUsd: -2e9 } };
      }
    }

    async function fetchProtocolTVLBillions(slugs){
      for(const slug of slugs){
        try{
          const d = await fetchJSON('https://api.llama.fi/protocol/'+slug);
          const tvlUsd = Array.isArray(d.tvl) ? latestNumberFrom(d.tvl, ['tvl','totalLiquidityUSD','totalLiquidityUsd']) : null;
          if (typeof tvlUsd === 'number') return tvlUsd/1e9;
        }catch(e){ /* try next */ }
      }
      return null;
    }

    async function fetchBankData(){
      // Keep fallback for now to avoid CORS parsing complexity here; previous version had HTML scraping.
      return bankData;
    }

    function buildDisplayIndices(sorted, targets, window=3){
      // targets: array of indexes to ensure visibility
      const idxs = new Set();
      const n = sorted.length;
      for(const t of targets){
        for(let i=Math.max(0,t-window); i<=Math.min(n-1,t+window); i++) idxs.add(i);
      }
      const list = Array.from(idxs).sort((a,b)=>a-b);
      // create blocks with ellipsis gaps
      const blocks = [];
      for(let i=0;i<list.length;i++){
        const cur=list[i], prev=list[i-1];
        if(i>0 && cur!==prev+1) blocks.push('...');
        blocks.push(cur);
      }
      return blocks;
    }

    function renderTable(allBanks, aaveB, aaveMeta, morphoB, sparkB){
      const tableBody = document.getElementById('tableBody');
      tableBody.innerHTML = '';

      const rows = [...allBanks];
      const AAVE = { name:'Aave', assets:aaveB??12.5, isAave:true };
      const MORPHO = { name:'Morpho', assets:morphoB??null, isMorpho:true };
      const SPARK = { name:'Spark', assets:sparkB??null, isSpark:true };
      // Only include protocols we have a number for; keep Aave always
      const protocols = [AAVE];
      if (typeof MORPHO.assets === 'number') protocols.push(MORPHO);
      if (typeof SPARK.assets === 'number') protocols.push(SPARK);

      const combined = rows.concat(protocols).sort((a,b)=> (b.assets??-Infinity) - (a.assets??-Infinity));

      const idxA = combined.findIndex(x=>x.isAave);
      const idxM = combined.findIndex(x=>x.isMorpho);
      const idxS = combined.findIndex(x=>x.isSpark);
      const targetIdxs = [idxA, idxM, idxS].filter(i=>i>=0);
      const display = buildDisplayIndices(combined, targetIdxs, 3);

      function nameCell(item){
        if(item.isAave){
          return `<span class="logo" aria-hidden="true"><img src="aave.svg" alt="Aave logo" style="width:72px;height:72px;vertical-align:middle"></span>
                  <span class="aave-badge"><span class="aave-arrow" aria-hidden="true">âžœ</span> <a href="https://app.aave.com/" target="_blank" rel="noopener">deposit now</a></span>`;
        }
        return item.name;
      }

      for(const entry of display){
        if(entry==='...'){
          const tr=document.createElement('tr'); tr.className='ellipsis-row';
          tr.innerHTML = `<td colspan="3">â€¦</td>`; tableBody.appendChild(tr); continue;
        }
        const item = combined[entry];
        const tr = document.createElement('tr');
        if (item.isAave) tr.className = 'aave-row highlight';
        const rank = entry+1;
        tr.innerHTML = `<td data-label="Rank">${rank}</td>
                        <td data-label="Name">${nameCell(item)}</td>
                        <td data-label="Assets" title="Banks: Total Assets; Aave: TVL+Borrowedâˆ’$2B; Others: TVL">${formatAssets(item.assets)}</td>`;
        tableBody.appendChild(tr);
      }

      const info = document.getElementById('error');
      const parts=[];
      if (aaveMeta && (aaveMeta.tvlUsd!=null || aaveMeta.borrowedUsd!=null)){
        const tvlB = aaveMeta.tvlUsd!=null ? (aaveMeta.tvlUsd/1e9).toFixed(1) : 'â€”';
        const borB = aaveMeta.borrowedUsd!=null ? (aaveMeta.borrowedUsd/1e9).toFixed(1) : 'â€”';
        const aaveFinalB = typeof aaveB==='number' ? aaveB.toFixed(1) : 'â€”';
        parts.push(`Aave: TVL $${tvlB}B + Borrowed $${borB}B âˆ’ $2.0B = $${aaveFinalB}B`);
      }
      if (typeof morphoB==='number') parts.push(`Morpho TVL: $${morphoB.toFixed(1)}B`);
      if (typeof sparkB==='number') parts.push(`Spark TVL: $${sparkB.toFixed(1)}B`);
      info.textContent = parts.join(' Â· ');
      info.style.display = 'block'; info.style.color = '#ffffff'; info.style.opacity = '0.85';
    }

    function setLastUpdated(tsISO, labelSuffix = '') {
      const el = document.getElementById('lastUpdated');
      const d = tsISO ? new Date(tsISO) : new Date();
      el.textContent = `Last updated: ${d.toLocaleString()}${labelSuffix}`;
    }

    function saveCache(banks, aave, tsISO, aaveMeta, morpho, spark) {
      localStorage.setItem(CACHE_KEYS.banks, JSON.stringify(banks));
      localStorage.setItem(CACHE_KEYS.aave, JSON.stringify(aave));
      localStorage.setItem(CACHE_KEYS.aaveMeta, JSON.stringify(aaveMeta||null));
      localStorage.setItem(CACHE_KEYS.morpho, JSON.stringify(morpho));
      localStorage.setItem(CACHE_KEYS.spark, JSON.stringify(spark));
      localStorage.setItem(CACHE_KEYS.ts, tsISO);
    }

    function readCache() {
      try {
        const banks = JSON.parse(localStorage.getItem(CACHE_KEYS.banks) || 'null');
        const aave = JSON.parse(localStorage.getItem(CACHE_KEYS.aave) || 'null');
        const aaveMeta = JSON.parse(localStorage.getItem(CACHE_KEYS.aaveMeta) || 'null');
        const morpho = JSON.parse(localStorage.getItem(CACHE_KEYS.morpho) || 'null');
        const spark = JSON.parse(localStorage.getItem(CACHE_KEYS.spark) || 'null');
        const ts = localStorage.getItem(CACHE_KEYS.ts);
        if (banks && Array.isArray(banks) && typeof aave === 'number' && ts) {
          return { banks, aave, ts, aaveMeta, morpho, spark };
        }
      } catch {}
      return null;
    }

    async function loadData(){
      const btn = document.getElementById('refreshBtn');
      const state = document.getElementById('dataState');
      try{
        if(btn) btn.disabled = true; if(state) state.textContent = 'Refreshingâ€¦';
        document.getElementById('loading').style.display='block';
        document.getElementById('dataTable').style.display='none';
        document.getElementById('error').style.display='none';

        const [banks, aaveRes, morphoB, sparkB] = await Promise.all([
          fetchBankData(),
          fetchAaveFullValue(),
          fetchProtocolTVLBillions(['morpho','morpho-blue']),
          fetchProtocolTVLBillions(['spark','spark-protocol','spark-lend'])
        ]);

        const allBanks = banks.length>20 ? banks : bankData;
        renderTable(allBanks, aaveRes.valueB ?? 12.5, aaveRes.meta, morphoB, sparkB);

        document.getElementById('loading').style.display='none';
        document.getElementById('dataTable').style.display='table';
        const nowISO = new Date().toISOString();
        setLastUpdated(nowISO);
        saveCache(allBanks, (aaveRes.valueB ?? 12.5), nowISO, aaveRes.meta, morphoB, sparkB);
        if(state) state.textContent = 'Up to date';
      }catch(e){
        console.error('Error loading data', e);
        renderTable(bankData, 12.5, null, null, null);
        document.getElementById('loading').style.display='none';
        document.getElementById('dataTable').style.display='table';
        setLastUpdated(null, ' (Fallback Data)');
        if(state) state.textContent = 'Using fallback data';
      }finally{ if(btn) btn.disabled=false; }
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      const cached = readCache();
      const loading = document.getElementById('loading');
      const table = document.getElementById('dataTable');
      const state = document.getElementById('dataState');

      if (cached) {
        renderTable(cached.banks, cached.aave, cached.aaveMeta, cached.morpho, cached.spark);
        loading.style.display='none'; table.style.display='table'; setLastUpdated(cached.ts, ' (cached)');
        if (state) state.textContent = 'Showing cached data';
      } else {
        if (state) state.textContent = 'First load';
        loadData();
      }

      document.getElementById('refreshBtn').addEventListener('click', async () => {
        const btn = document.getElementById('refreshBtn');
        const state = document.getElementById('dataState');
        try {
          btn.disabled = true; state.textContent = 'Updating dataâ€¦';
          await loadData(); btn.disabled = true; state.textContent = 'Data saved. Reloadingâ€¦';
        } catch (e) { console.error(e); state.textContent = 'Update failed, reloading anywayâ€¦'; }
        setTimeout(() => { const url = new URL(window.location.href); url.searchParams.set('t', Date.now().toString()); window.location.replace(url.toString()); }, 500);
      });
    });
  </script>
</body>
</html>
```
